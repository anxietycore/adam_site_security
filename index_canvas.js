(()=>{const e="'Press Start 2P', monospace",t=12,n=Math.round(1.45*t),s=Math.min(window.devicePixelRatio||1,1.5),o=.0336,i=12,a={context:null,sounds:{},keyPressSounds:{},lastKeyPressSound:null,ambientBuffer:null,ambientSource:null,isInitialized:!1,loadedCount:0,totalSounds:12,init(){this.isInitialized||"undefined"!=typeof Audio&&(this.context=new(window.AudioContext||window.webkitAudioContext),this.isInitialized=!0,this.loadSound("confirm","sounds/index/confirm.mp3"),this.loadSound("reject","sounds/index/reject.mp3"),this.loadSound("glitch_error","sounds/index/glitch_error.mp3"),this.loadSound("success","sounds/index/success.mp3"),this.loadSound("boot","sounds/index/boot_sequence.mp3"),this.loadKeyPressSound("interface_key_press_01.mp3"),this.loadKeyPressSound("interface_key_press_02.mp3"),this.loadKeyPressSound("interface_key_press_03.mp3"),this.loadKeyPressSound("interface_key_press_04.mp3"),this.loadKeyPressSound("interface_key_press_backspace.mp3"),this.loadKeyPressSound("interface_key_press_enter.mp3"),this.loadAmbientSound("ambient_terminal","sounds/ambient/ambient_terminal.mp3"))},loadSound(e,t){this.sounds[e]=new Audio,this.sounds[e].preload="auto",this.sounds[e].volume=.3,this.sounds[e].addEventListener("canplaythrough",(()=>{this.loadedCount++})),this.sounds[e].addEventListener("error",(()=>{this.loadedCount++})),this.sounds[e].src=t},loadKeyPressSound(e){const t="sounds/interface/"+e,n=e.replace(".mp3","");this.keyPressSounds[n]=new Audio,this.keyPressSounds[n].preload="auto",this.keyPressSounds[n].volume=.25,this.keyPressSounds[n].addEventListener("canplaythrough",(()=>{this.loadedCount++})),this.keyPressSounds[n].addEventListener("error",(()=>{this.loadedCount++})),this.keyPressSounds[n].src=t},playKeyPress(e="generic"){if(!this.isInitialized)return;let t;switch(e.toLowerCase()){case"backspace":t="interface_key_press_backspace";break;case"enter":t="interface_key_press_enter";break;case"generic":const e=["interface_key_press_01","interface_key_press_02","interface_key_press_03","interface_key_press_04"];let n=e.filter((e=>e!==this.lastKeyPressSound));0===n.length&&(n=e),t=n[Math.floor(Math.random()*n.length)],this.lastKeyPressSound=t;break;default:t="interface_key_press_01"}const n=this.keyPressSounds[t];if(n)if(n.readyState<2)n.addEventListener("canplaythrough",(()=>this.playKeyPress(e)),{once:!0});else try{n.currentTime=0,n.volume=.25,n.play().catch((()=>{}))}catch(e){}},loadAmbientSound(e,t){fetch(t).then((e=>e.arrayBuffer())).then((e=>this.context.decodeAudioData(e))).then((e=>{this.ambientBuffer=e,this.loadedCount++})).catch((()=>{this.loadedCount++}))},playSound(e,t=1){if(!this.isInitialized)return;const n=this.sounds[e];if(n)if(n.readyState<2)n.addEventListener("canplaythrough",(()=>this.playSound(e,t)),{once:!0});else try{n.currentTime=0,n.volume=Math.max(0,Math.min(1,t)),n.play().catch((()=>{}))}catch(e){}},playAmbient(e=.15){if(this.isInitialized&&this.ambientBuffer){this.stopAmbient();try{this.ambientSource=this.context.createBufferSource(),this.ambientSource.buffer=this.ambientBuffer,this.ambientSource.loop=!0;const t=this.context.createGain();t.gain.value=Math.max(0,Math.min(1,e)),this.ambientSource.connect(t),t.connect(this.context.destination),this.ambientSource.start(0)}catch(e){}}},stopAmbient(){if(this.ambientSource){try{this.ambientSource.stop(),this.ambientSource.disconnect()}catch(e){}this.ambientSource=null}}},r=[];let l=0,c=0,d=0,h=0,u=!1;history.pushState(null,null,location.href),window.onpopstate=function(){history.go(1)};const f=document.createElement("canvas");f.id="indexCanvas",Object.assign(f.style,{position:"fixed",left:"0",top:"0",width:"100%",height:"100%",zIndex:"50",pointerEvents:"auto"}),document.body.appendChild(f);const m=f.getContext("2d",{alpha:!1});let y=0,p=0,_="confirm",b=0,g=0,S="",k=!1,w=!1,x=!1,F=0,A=0,M="",v=0,P="01#$%&*+-=?@[]{}<>~^";function C(){y=Math.max(320,window.innerWidth),p=Math.max(240,window.innerHeight),f.width=Math.floor(y*s),f.height=Math.floor(p*s),f.style.width=y+"px",f.style.height=p+"px",m.setTransform(s,0,0,s,0,0),function(){const e=Math.max(256,Math.floor(.8*y)),t=Math.max(256,Math.floor(.8*p));r.length=0;for(let n=0;n<8;n++){const n=document.createElement("canvas");n.width=e,n.height=t;const s=n.getContext("2d"),o=s.createImageData(e,t),i=o.data;for(let e=0;e<i.length;e+=4){const t=255*Math.random();i[e]=i[e+1]=i[e+2]=t,i[e+3]=255}s.putImageData(o,0,0),r.push(n)}}()}window.addEventListener("resize",C),C();const T=["> ИНИЦИАЛИЗАЦИЯ КВАНТОВЫХ ЯДЕР...","> СИНХРОНИЗАЦИЯ ВРЕМЕННЫХ СВЯЗЕЙ...","> АКТИВАЦИЯ НЕЙРОИНТЕРФЕЙСА...","> ЗАПУСК ПРОТОКОЛА THETA-7...","> УСТАНОВКА СЕТИ НАБЛЮДЕНИЯ...","> ДЕКОДИРОВАНИЕ ПРОТОКОЛОВ...","> ПОДКЛЮЧЕНИЕ К СОЗНАНИЮ A.D.A.M...","> ФИНАЛИЗАЦИЯ ПАРАМЕТРОВ ДОСТУПА..."];function I(s,o,i,a="#00FF41",r=1){m.save(),m.globalAlpha=r,m.font=`${t}px ${e}`,m.fillStyle=a,m.textBaseline="top",s.split("\n").forEach(((e,t)=>m.fillText(e,o,i+t*n))),m.restore()}function K(n,s,o,i="#00FF41",a=1,r=0){if(m.save(),m.globalAlpha=a,m.font=`${t}px ${e}`,m.textBaseline="top",r>0){const e=2.5*r;m.fillStyle="rgba(255,0,0,0.9)",m.fillText(n,s-e+2*Math.random(),o+2*Math.random()),m.fillStyle="rgba(0,255,0,0.9)",m.fillText(n,s+e+2*Math.random(),o-2*Math.random()),m.fillStyle="rgba(0,100,255,0.9)",m.fillText(n,s+2*Math.random(),o-e)}m.fillStyle=i,m.fillText(n,s,o),m.restore()}function E(n){return m.font=`${t}px ${e}`,m.measureText(n).width}function L(){d=1;const e=()=>{d=Math.max(0,d-.15),d>0&&requestAnimationFrame(e)};setTimeout(e,100)}document.addEventListener("keydown",(e=>{if(!u)if(a.isInitialized||a.init(),"confirm"===_){if("y"===e.key.toLowerCase()||"н"===e.key.toLowerCase())a.playSound("confirm",.3),_="boot",b=0,M="",v=0,g=0,a.playSound("boot",.15);else if("n"===e.key.toLowerCase()||"т"===e.key.toLowerCase()){a.playSound("reject",.3),u=!0;const e=()=>{h+=.04,h<1?requestAnimationFrame(e):setTimeout((()=>{window.location.href="about:blank"}),2e3)};e()}}else"code"===_&&k&&("Enter"===e.key?(a.playKeyPress("enter"),"observer"===S?(a.playSound("success",.4),L(),x=!0,setTimeout((()=>{document.body.style.transition="opacity 0.8s ease-in-out",document.body.style.opacity="0"}),800),setTimeout((()=>{window.location.href="terminal.html"}),1600)):(a.playSound("glitch_error",.5),function(){c=1,w=!0,F=60,a.playSound("glitch_error",.5);const e=()=>{c=Math.max(0,c-.08),c>0&&requestAnimationFrame(e)};setTimeout(e,150)}(),L(),S="")):"Backspace"===e.key?(a.playKeyPress("backspace"),S=S.slice(0,-1)):1===e.key.length&&/^[a-zA-Z0-9]$/.test(e.key)&&(a.playKeyPress("generic"),S.length<i&&(S+=e.key)))})),function e(){switch(A++,l++,function(){if("boot"!==_||b>=T.length)return;const e=T[b];if(g%2==0&&v<e.length){if(Math.random()>.5){const t=P.charAt(Math.floor(Math.random()*P.length));M=e.substring(0,v)+t}M=e.substring(0,v+1),v++}v>=e.length&&g%35==0&&(b++,v=0,M="",b>=T.length&&(a.stopAmbient(),a.playAmbient(.15),setTimeout((()=>{_="code",k=!0}),300))),g++}(),_){case"confirm":!function(){m.fillStyle="#000",m.fillRect(0,0,y,p),m.clearRect(0,0,y,p),m.save(),m.globalAlpha=o*(1-h);const e=r[l%r.length];m.drawImage(e,0,0,y,p),m.restore();const t="    \\    _ \\    \\     \\  | \n   _ \\   |  |  _ \\   |\\/ | \n _/  _\\ ___/ _/  _\\ _|  _| ",n=E(t.split("\n")[0]),s=p/2-90;I(t,(y-n)/2,s,"#00FF41",1-h);const i="ИНИЦИАЛИЗАЦИЯ СИСТЕМЫ";I(i,(y-E(i))/2,s+70,"#00FF41",.9*(1-h));const a="[Y/Н] - ПОДТВЕРДИТЬ | [N/Т] - ОТМЕНА";if(I(a,(y-E(a))/2,s+100,"#00FF41",.8*(1-h)),h>.5){const e="> ДОСТУП ЗАПРЕЩЁН";I(e,(y-E(e))/2,p/2,"#FF0000",2*(h-.5))}}();break;case"boot":!function(){m.fillStyle="#000",m.fillRect(0,0,y,p),m.save(),m.globalAlpha=o;const e=r[l%r.length];m.drawImage(e,0,0,y,p),m.restore();const t="    \\    _ \\    \\     \\  | \n   _ \\   |  |  _ \\   |\\/ | \n _/  _\\ ___/ _/  _\\ _|  _| ",n=E(t.split("\n")[0]),s=p/2-100;if(I(t,(y-n)/2,s),b<T.length){const e=(y-E(M))/2;I(M,e,s+70)}}();break;case"code":!function(){if(m.fillStyle="#000",m.fillRect(0,0,y,p),c>0){m.save(),m.globalAlpha=.3*c;const e=3*c;m.fillStyle="rgba(255,0,0,0.5)",m.fillRect(0,0,y,p),m.globalAlpha=.2*c;const t=r[l%r.length];m.drawImage(t,-e,-e,y,p),m.drawImage(t,e,e,y,p),m.restore(),m.save(),m.globalAlpha=.6*c;const n=r[3*l%r.length];m.drawImage(n,0,0,y,p),m.restore()}m.save(),m.globalAlpha=o*(1+c);const e=r[l%r.length];m.drawImage(e,0,0,y,p),m.restore();const t=(y-200)/2,s=p/2-20,a="ВХОД В ТЕРМИНАЛ";K(a,(y-E(a))/2,s-60,"#00FF41",1,d);const h="СЕКРЕТНЫЙ КОД:";K(h,t+(200-E(h))/2,s-n-8,"#00FF41",.85,d);const u=c>.5?"#FF0044":k?"#00FF88":"#00FF41";m.strokeStyle=u,m.lineWidth=k?2:1,m.strokeRect(t,s,200,30);const f=S.slice(-i),_=c>0?8:15;if(K(f+(A%_<_/2?"█":""),t+5,s+6,"#FFFFFF",1,d),w&&F>0){const e="> ДОСТУП ЗАПРЕЩЁН";I(e,(y-E(e))/2,s+50,"#FF0000",.9+.1*c),F--}if(x){const e="> УСПЕШНЫЙ ВХОД";I(e,(y-E(e))/2,s+50,"#00FF41",1)}}()}requestAnimationFrame(e)}()})();
